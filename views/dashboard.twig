{% extends "main.twig" %}
{% block title %}
Dashboard |
{{ parent() }}
{% endblock %}

{# bloque de estilos #}
{% block styles %}
<style>

        </style>
{% endblock %}

{% block navbar %}
{{ parent() }}
{% endblock navbar %}

{# bloque del contenido de cada vista #}
{% block contenido %}
<div class="container">
<div class="row text-center">
    <h1>Listas de reportes activos</h1>
</div>
    <div class="table-responsive">
        <table class="table table-striped table-hover table-borderless table-primary align-middle">
            <thead class="table-light">
                <tr>
                    <th>#</th>
                    <th>Tipo</th>
                    <th>Fecha</th>
                    <th>Estado</th>
                    <th>Estado</th>
                </tr>
                </thead>
                <tbody class="table-group-divider">
                    {% for row, reporte in reportes %}
                    <tr class="table-primary" >
                        <td scope="row">{{row + 1}}</td>
                        <td>{{ reporte.tipo }}</td>
                        <td>{{ reporte.created_at }}</td>
                        <td>{{ reporte. id_notificacion }}</td>
                        <td>
                            <div class="form-group">
                                <select class="form-control estado" id="{{ reporte. id_notificacion }}" >
                                    <option value="Reportado" {% if reporte.estado == 'Reportado' %} selected disabled {% endif %}>Reportado</option>
                                    <option value="En camino" {% if reporte.estado == 'En camino' %} selected disabled {% endif %}>En camino</option>
                                    <option value="Antendiendo" {% if reporte.estado == 'Antendiendo' %} selected disabled {% endif %}>Antendiendo</option>
                                    <option value="Finalizado" {% if reporte.estado == 'Finalizado' %} selected disabled {% endif %}>Finalizado</option>
                                </select>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}

                </tbody>
        </table>
    </div>
    
</div>
{% endblock contenido %}

{% block footer %}
{{ parent() }}
{% endblock footer %}

{% block scripts %}
	{{ parent() }}
	<script>
        $('.estado').change(function (e) { 
            e.preventDefault();
            let obj = e.target
            let id = obj.getAttribute('id')
            let estado = obj.value

            $.ajax({
                type: "post",
                url: "/notificaciones/update",
                data: {
                    id,
                    estado
                },
                dataType: "json",
                success: function (response) {
                    //dispara alerta
                    Swal.fire({
                        title: 'Aviso',
                        text: response.responseMessage,
                        icon: response.tipoRespuesta,
                        confirmButtonText: 'OK',
                        allowOutsideClick: false,
                        allowEscapeKey: false,
                        allowEnterKey: true
                    }).then((result) => {
                        if (result.isConfirmed) {
                            location.reload();
                        }
                    })

                }
            });
        });

    </script>
{% endblock scripts %}